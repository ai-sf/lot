{% assign navurl = page.url | remove: 'index.html' %}

{% for item in include.nav %}
    {% if item.subitems %}
    <ul id="dropdown-{{ item.slug }}" class="dropdown-content">
      <li><a href="{{ site.url }}/{{ item.url }}">{{ item.text }}</a></li>
      {% for subitem in item.subitems %}
      <li><a href="{{ site.url }}/{{ subitem.url }}">{{ subitem.text }}</a></li>
      {% endfor %}
    </ul>
    {% endif %}
{% endfor %}

<nav class="custom-nav" role="navigation">
    <div class="nav-wrapper container">
        
        <a href="#" data-activates="nav-mobile" class="button-collapse hide-on-large-only">
            <i class="material-icons">menu</i>
        </a>
        
        <a id="logo-container" href="{{ site.url }}/index.html" class="brand-logo">{{ site.data.generic.title }}</a>

        <ul class="right hide-on-med-and-down">
          {% for item in include.nav %}
            {% if item.subitems %}
            <li><a class="dropdown-button" href="{{ site.url }}/{{ item.url }}" data-activates="dropdown-{{ item.slug }}">{{ item.text }}<i class="material-icons right">arrow_drop_down</i></a></li>
            {% else %}
            <li><a href="{% if item.url contains 'http' %}{{ item.url }}{% else %}{{ site.url }}/{{ item.url }}{% endif %}">{% if item.url == navurl %}<b>{{ item.text }}</b>{% else %}{{ item.text }}{% endif %}</a></li>
            {% endif %}
          {% endfor %}
          
          <li class="valign-wrapper" style="height: 64px; margin-left: 20px;">
              <div class="switch">
                <label style="display: flex; align-items: center;">
                  <i class="material-icons" style="font-size: 1.2rem; color: #fff;">wb_sunny</i>
                  <input type="checkbox" id="dark-mode-toggle">
                  <span class="lever"></span>
                  <i class="material-icons" style="font-size: 1.2rem; color: #fff;">brightness_3</i>
                </label>
              </div>
          </li>
        </ul>
        
        </div>
</nav>

<ul id="nav-mobile" class="side-nav">
    <li class="logo">
        <a href="{{ site.url }}">
            <object type="image/png" style="height:64px" data="{{ site.url }}/img/Banner_2.png">PNG</object>
        </a>
    </li>
    
    {% for item in include.nav %}
        {% if item.subitems %}
        <li class="no-padding">
            <ul class="collapsible collapsible-accordion">
                <li>
                    <a class="collapsible-header">{{ item.text }}<i class="material-icons right">arrow_drop_down</i></a>
                    <div class="collapsible-body">
                        <ul>
                            <li><a href="{{ site.url }}/{{ item.url }}">{{ item.text }}</a></li>
                            {% for subitem in item.subitems %}
                            <li><a href="{{ site.url }}/{{ subitem.url }}">{{ subitem.text }}</a></li>
                            {% endfor %}
                        </ul>
                    </div>
                </li>
            </ul>
        </li>
        {% else %}
        <li><a href="{% if item.url contains 'http' %}{{ item.url }}{% else %}{{ site.url }}/{{ item.url }}{% endif %}">{{ item.text }}</a></li>
        {% endif %}
    {% endfor %}
    
    <li class="divider"></li>
    
    <li>
        <div class="switch" style="padding-left: 32px; margin-top: 10px;">
            <label>
                <input type="checkbox" id="dark-mode-toggle-mobile">
                <span class="lever"></span> Dark Mode
            </label>
        </div>
    </li>
</ul>

<script>
(function() {
  const html = document.documentElement;
  const applyTheme = (theme) => { theme === 'dark' ? html.setAttribute('data-theme', 'dark') : html.removeAttribute('data-theme'); };
  const savedTheme = localStorage.getItem('theme-choice');
  if (savedTheme) applyTheme(savedTheme);
  document.addEventListener('DOMContentLoaded', () => {
    const tDesktop = document.getElementById('dark-mode-toggle');
    const tMobile = document.getElementById('dark-mode-toggle-mobile');
    const sync = (checked) => { 
      const theme = checked ? 'dark' : 'light'; 
      applyTheme(theme); 
      localStorage.setItem('theme-choice', theme); 
      if(tDesktop) tDesktop.checked = checked; 
      if(tMobile) tMobile.checked = checked; 
    };
    if(tDesktop) { tDesktop.checked = (savedTheme === 'dark'); tDesktop.addEventListener('change', (e) => sync(e.target.checked)); }
    if(tMobile) { tMobile.checked = (savedTheme === 'dark'); tMobile.addEventListener('change', (e) => sync(e.target.checked)); }
  });
})();
</script>